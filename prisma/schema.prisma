generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Sprint {
  id        Int         @id @default(autoincrement())
  name      String
  goal      String?
  startDate DateTime
  endDate   DateTime
  status    String      @default("planned")
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  UserStory UserStory[]
}

model User {
  id            Int             @id @default(autoincrement())
  name          String
  email         String          @unique
  password      String
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  role          String          @default("teammate")
  UserStory     UserStory[]
  PasswordReset PasswordReset[]
}

model PasswordReset {
  id        Int      @id @default(autoincrement())
  email     String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  User      User     @relation(fields: [email], references: [email], onDelete: Cascade)

  @@index([token])
  @@index([email])
}

model UserStory {
  id          Int               @id @default(autoincrement())
  title       String
  description String?
  userId      Int
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  sprintId    Int?
  status      UserStoryStatus   @default(BACKLOG)
  priority    UserStoryPriority @default(Medium)
  position    Int               @default(0)
  storyPoints Int?
  Sprint      Sprint?           @relation(fields: [sprintId], references: [id])
  User        User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([sprintId])
  @@index([userId])
  @@index([priority], map: "idx_userstory_priority")
  @@index([status], map: "idx_userstory_status")
  @@index([status, position], map: "idx_userstory_status_position")
}

enum UserStoryPriority {
  Low
  Medium
  High
}

enum UserStoryStatus {
  BACKLOG
  TO_DO
  DOING
  TO_TEST
  ISSUE
  DONE
}
